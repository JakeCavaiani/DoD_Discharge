# September step change
poke.before <- poke.final.pressure.2022[c(1:37665), ]
poke.after <- poke.final.pressure.2022[c(37705:40000), ]
poke.final.pressure.2022[37705, 9] - poke.final.pressure.2022[37665, 9] # 0.374
poke.after$WaterPressure.merged <- poke.after[, 9] + 0.374
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
# End of August step change... move after data down all the way?
poke.before <- poke.final.pressure.2022[c(1:29616), ]
poke.after <- poke.final.pressure.2022[c(29628:40000), ]
poke.final.pressure.2022[29628, 9] - poke.final.pressure.2022[29616, 9] # 1.037
poke.after$WaterPressure.merged <- poke.after[, 9] - 1.037
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
poke.final.pressure.2022 %>% #filter(DateTimeAK > "2022-08-29" & DateTimeAK < "2022-08-29 17:00:00") %>%
ggplot() + geom_point(aes(DateTimeAK, WaterPressure.merged))
#poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-06-05" & DateTimeAK < "2022-06-06 17:00:00") %>% View()
# Join the two atmospheric and water pressure together
poke.final.pressure.2022.2 <- poke.final.pressure.2022 %>% filter(!WaterPressure.merged %in% NA)
POKE.2022 <- left_join(eielson.atmo.2022.compare, poke.final.pressure.2022.2, by = "DateTimeAK")
# Water pressure - atmospheric pressure
POKE.2022$difference <- POKE.2022$WaterPressure.merged - POKE.2022$AirPressureCorrectedPOKE
before <- POKE.2022 %>% filter(DateTimeAK > "2022-07-20" & DateTimeAK < "2022-07-30") %>% summarise(mean(difference, na.rm = TRUE))
after <- POKE.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-05") %>% summarise(mean(difference, na.rm = TRUE))
before - after
# Plot air and water pressure
POKE.2022 %>% filter(DateTimeAK > "2022-05-25") %>%
ggplot(aes(DateTimeAK, WaterPressure.merged)) + geom_point() + geom_point(aes(DateTimeAK, AirPressureCorrectedPOKE), color = "red")
before - after
before
after
before - after
# merge to one
poke.final.pressure.2022 <- left_join(poke.stream.one.2022, poke.stream.two.2022, by = c("DateTimeAK"))
poke.final.pressure.2022$MeanPressure <- rowMeans(poke.final.pressure.2022[,c(2,6)], na.rm = TRUE)
poke.final.pressure.2022 %>% ggplot() + geom_point(aes(DateTimeAK, WaterPressure.x)) + geom_point(aes(DateTimeAK, WaterPressure.y), color = "red", cex = 0.5)
## Use PT1 before August 1st and PT2 after August 1st
# Shift PT2 up to match August PT1
poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-15") %>% summarise(mean(WaterPressure.x - WaterPressure.y)) #2.62398
poke.final.pressure.2022 <- poke.final.pressure.2022 %>%
mutate(WaterPressure.merged = ifelse(DateTimeAK <= "2022-08-01", WaterPressure.x, WaterPressure.y))  ## but don't move it all the way up??
# September step change
poke.before <- poke.final.pressure.2022[c(1:37665), ]
poke.after <- poke.final.pressure.2022[c(37705:40000), ]
poke.final.pressure.2022[37705, 9] - poke.final.pressure.2022[37665, 9] # 0.374
poke.after$WaterPressure.merged <- poke.after[, 9] + 0.374
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
# End of August step change... move after data down all the way?
poke.before <- poke.final.pressure.2022[c(1:29616), ]
poke.after <- poke.final.pressure.2022[c(29628:40000), ]
poke.final.pressure.2022[29628, 9] - poke.final.pressure.2022[29616, 9] # 1.037
poke.after$WaterPressure.merged <- poke.after[, 9] - 1.037
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
poke.final.pressure.2022 %>% #filter(DateTimeAK > "2022-08-29" & DateTimeAK < "2022-08-29 17:00:00") %>%
ggplot() + geom_point(aes(DateTimeAK, WaterPressure.merged))
#poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-06-05" & DateTimeAK < "2022-06-06 17:00:00") %>% View()
# Join the two atmospheric and water pressure together
poke.final.pressure.2022.2 <- poke.final.pressure.2022 %>% filter(!WaterPressure.merged %in% NA)
POKE.2022 <- left_join(eielson.atmo.2022.compare, poke.final.pressure.2022.2, by = "DateTimeAK")
# Water pressure - atmospheric pressure
POKE.2022$difference <- POKE.2022$WaterPressure.merged - POKE.2022$AirPressureCorrectedPOKE
before <- POKE.2022 %>% filter(DateTimeAK > "2022-07-20" & DateTimeAK < "2022-07-30") %>% summarise(mean(difference, na.rm = TRUE))
after <- POKE.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-05") %>% summarise(mean(difference, na.rm = TRUE))
before - after
# merge to one
poke.final.pressure.2022 <- left_join(poke.stream.one.2022, poke.stream.two.2022, by = c("DateTimeAK"))
poke.final.pressure.2022$MeanPressure <- rowMeans(poke.final.pressure.2022[,c(2,6)], na.rm = TRUE)
poke.final.pressure.2022 %>% ggplot() + geom_point(aes(DateTimeAK, WaterPressure.x)) + geom_point(aes(DateTimeAK, WaterPressure.y), color = "red", cex = 0.5)
## Use PT1 before August 1st and PT2 after August 1st
# Shift PT2 up to match August PT1
poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-15") %>% summarise(mean(WaterPressure.x - WaterPressure.y)) #2.62398
poke.final.pressure.2022 <- poke.final.pressure.2022 %>%
mutate(WaterPressure.merged = ifelse(DateTimeAK <= "2022-08-01", WaterPressure.x, WaterPressure.y + 2.251515))  ## but don't move it all the way up??
# September step change
poke.before <- poke.final.pressure.2022[c(1:37665), ]
poke.after <- poke.final.pressure.2022[c(37705:40000), ]
poke.final.pressure.2022[37705, 9] - poke.final.pressure.2022[37665, 9] # 0.374
poke.after$WaterPressure.merged <- poke.after[, 9] + 0.374
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
# End of August step change... move after data down all the way?
poke.before <- poke.final.pressure.2022[c(1:29616), ]
poke.after <- poke.final.pressure.2022[c(29628:40000), ]
poke.final.pressure.2022[29628, 9] - poke.final.pressure.2022[29616, 9] # 1.037
poke.after$WaterPressure.merged <- poke.after[, 9] - 1.037
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
poke.final.pressure.2022 %>% #filter(DateTimeAK > "2022-08-29" & DateTimeAK < "2022-08-29 17:00:00") %>%
ggplot() + geom_point(aes(DateTimeAK, WaterPressure.merged))
#poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-06-05" & DateTimeAK < "2022-06-06 17:00:00") %>% View()
# Join the two atmospheric and water pressure together
poke.final.pressure.2022.2 <- poke.final.pressure.2022 %>% filter(!WaterPressure.merged %in% NA)
POKE.2022 <- left_join(eielson.atmo.2022.compare, poke.final.pressure.2022.2, by = "DateTimeAK")
# Water pressure - atmospheric pressure
POKE.2022$difference <- POKE.2022$WaterPressure.merged - POKE.2022$AirPressureCorrectedPOKE
before <- POKE.2022 %>% filter(DateTimeAK > "2022-07-20" & DateTimeAK < "2022-07-30") %>% summarise(mean(difference, na.rm = TRUE))
after <- POKE.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-05") %>% summarise(mean(difference, na.rm = TRUE))
before - after
# Plot air and water pressure
POKE.2022 %>% filter(DateTimeAK > "2022-05-25") %>%
ggplot(aes(DateTimeAK, WaterPressure.merged)) + geom_point() + geom_point(aes(DateTimeAK, AirPressureCorrectedPOKE), color = "red")
before - after
# merge to one
poke.final.pressure.2022 <- left_join(poke.stream.one.2022, poke.stream.two.2022, by = c("DateTimeAK"))
poke.final.pressure.2022$MeanPressure <- rowMeans(poke.final.pressure.2022[,c(2,6)], na.rm = TRUE)
poke.final.pressure.2022 %>% ggplot() + geom_point(aes(DateTimeAK, WaterPressure.x)) + geom_point(aes(DateTimeAK, WaterPressure.y), color = "red", cex = 0.5)
# merge to one
poke.final.pressure.2022 <- left_join(poke.stream.one.2022, poke.stream.two.2022, by = c("DateTimeAK"))
poke.final.pressure.2022$MeanPressure <- rowMeans(poke.final.pressure.2022[,c(2,6)], na.rm = TRUE)
poke.final.pressure.2022 %>% ggplot() + geom_point(aes(DateTimeAK, WaterPressure.x)) + geom_point(aes(DateTimeAK, WaterPressure.y), color = "red", cex = 0.5)
## Use PT1 before August 1st and PT2 after August 1st
# Shift PT2 up to match August PT1
poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-15") %>% summarise(mean(WaterPressure.x - WaterPressure.y)) #2.62398
poke.final.pressure.2022 <- poke.final.pressure.2022 %>%
mutate(WaterPressure.merged = ifelse(DateTimeAK <= "2022-08-01", WaterPressure.x, WaterPressure.y))
# September step change
poke.before <- poke.final.pressure.2022[c(1:37665), ]
poke.after <- poke.final.pressure.2022[c(37705:40000), ]
poke.final.pressure.2022[37705, 9] - poke.final.pressure.2022[37665, 9] # 0.374
poke.after$WaterPressure.merged <- poke.after[, 9] + 0.374
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
# End of August step change... move after data down all the way?
poke.before <- poke.final.pressure.2022[c(1:29616), ]
poke.after <- poke.final.pressure.2022[c(29628:40000), ]
poke.final.pressure.2022[29628, 9] - poke.final.pressure.2022[29616, 9] # 1.037
poke.after$WaterPressure.merged <- poke.after[, 9] - 1.037
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
poke.final.pressure.2022 %>% #filter(DateTimeAK > "2022-08-29" & DateTimeAK < "2022-08-29 17:00:00") %>%
ggplot() + geom_point(aes(DateTimeAK, WaterPressure.merged))
#poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-06-05" & DateTimeAK < "2022-06-06 17:00:00") %>% View()
# Join the two atmospheric and water pressure together
poke.final.pressure.2022.2 <- poke.final.pressure.2022 %>% filter(!WaterPressure.merged %in% NA)
POKE.2022 <- left_join(eielson.atmo.2022.compare, poke.final.pressure.2022.2, by = "DateTimeAK")
# Water pressure - atmospheric pressure
POKE.2022$difference <- POKE.2022$WaterPressure.merged - POKE.2022$AirPressureCorrectedPOKE
before <- POKE.2022 %>% filter(DateTimeAK > "2022-07-20" & DateTimeAK < "2022-07-30") %>% summarise(mean(difference, na.rm = TRUE))
after <- POKE.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-05") %>% summarise(mean(difference, na.rm = TRUE))
before - after
View(POKE.2022)
# Move data after July upward to match difference in air pressure
POKE.2022 <- POKE.2022 %>%
mutate(WaterPressure.merged = ifelse(DateTimeAK <= "2022-07-30", WaterPressure.x, WaterPressure.y + 2.251515))
# Plot air and water pressure
POKE.2022 %>% filter(DateTimeAK > "2022-05-25") %>%
ggplot(aes(DateTimeAK, WaterPressure.merged)) + geom_point() + geom_point(aes(DateTimeAK, AirPressureCorrectedPOKE), color = "red")
before <- POKE.2022 %>% filter(DateTimeAK > "2022-07-20" & DateTimeAK < "2022-07-30") %>% summarise(mean(difference, na.rm = TRUE))
after <- POKE.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-05") %>% summarise(mean(difference, na.rm = TRUE))
before - after
# Move data after July upward to match difference in air pressure
POKE.2022 <- POKE.2022 %>%
mutate(WaterPressure.merged = ifelse(DateTimeAK <= "2022-07-30", WaterPressure.x, WaterPressure.y + 2.251515))
before <- POKE.2022 %>% filter(DateTimeAK > "2022-07-20" & DateTimeAK < "2022-07-30") %>% summarise(mean(difference, na.rm = TRUE))
after <- POKE.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-05") %>% summarise(mean(difference, na.rm = TRUE))
before - after
# Plot air and water pressure
POKE.2022 %>% filter(DateTimeAK > "2022-05-25") %>%
ggplot(aes(DateTimeAK, WaterPressure.merged)) + geom_point() + geom_point(aes(DateTimeAK, AirPressureCorrectedPOKE), color = "red")
before - after
# Move data
POKE.2022 <- POKE.2022 %>%
mutate(across(c(WaterPressure.merged),
~ifelse(DateTimeAK < "2022-07-30", WaterPressure.merged + 2.251515, .)))
before <- POKE.2022 %>% filter(DateTimeAK > "2022-07-20" & DateTimeAK < "2022-07-30") %>% summarise(mean(difference, na.rm = TRUE))
after <- POKE.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-05") %>% summarise(mean(difference, na.rm = TRUE))
before - after
after
# Move data
POKE.2022 <- POKE.2022 %>%
mutate(across(c(WaterPressure.merged),
~ifelse(DateTimeAK < "2022-07-30", WaterPressure.merged + 2.251515, .)))
before - after
after
# Load packages #
library(tidyverse)
library(lubridate)
library(data.table)
library(rio)
library(ggplot2)
library(scales)
library(psych)
library(here)
library(googledrive)
library(readxl)
library(cowplot)
library(zoo)
library(readr)
library(dplyr)
library(RColorBrewer)
library(gridExtra)
library(ggpmisc)
library(birk)
library(neonUtilities)
# Import data from google drive #
discharge.2022 <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vQR6HHHDpnxc6DmNHfdNLR9-dgDHR5Imt0Ve4_t2DzIF18_8D3O2da5zcWQzJUSoFQfaetPZDeXZ610/pub?gid=0&single=true&output=csv"
QSummary.2022 <- read.csv(url(discharge.2022))
### Format Time ###
QSummary.2022$Date <- mdy(QSummary.2022$Date)
QSummary.2022$DateTimeAK <- as.POSIXct(paste(QSummary.2022$Date, QSummary.2022$Time), format = "%Y-%m-%d %H:%M", tz = "America/Anchorage")
QSummary.2022$DateTimeAK <- lubridate::round_date(QSummary.2022$DateTimeAK, "60 minutes")
### ALL Sites ###
QSummary.2022 %>% ggplot() +
geom_point(aes(x=DateTimeAK, y=MeasuredQ_Ls, color=Site, shape=Method), size=3) +
theme_classic() +
scale_color_manual(values=c("#FF7F00","#A6761D", "#6A3D9A", "#66C2A5", "#E7298A")) + ggtitle("ALL SITES")
eielson.atmo.2022.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vQjJbkVdOseFUsTFMDXaHRoKkPiFt6Uvc-9R3tkFZxKFjqSmPPgZzexdbhezBr_qYgGUdVN6ywYR28c/pub?output=csv"
eielson.atmo.2022 <- read.csv(url(eielson.atmo.2022.url), skip = 6)
eielson.atmo.2022 <- eielson.atmo.2022[-1,]
names(eielson.atmo.2022) <- c("Site", "DateTimeAK", "sea_level_pressure", "AirPressure")
eielson.atmo.2022$DateTimeAK <- mdy_hm(eielson.atmo.2022$DateTimeAK)
# Correct time zone
eielson.atmo.2022$DateTimeAK <- eielson.atmo.2022$DateTimeAK - 28800
#eielson.atmo.2022$DateTimeAK <- force_tz(eielson.atmo.2022$DateTimeAK, tzone = "America/Anchorage")
#attributes(eielson.atmo.2022$DateTimeAK)$tzone <- "America/Anchorage"
eielson.atmo.2022$DateTimeAK <- lubridate::round_date(eielson.atmo.2022$DateTimeAK, "15 minutes")
eielson.atmo.2022$AirPressure <- as.numeric(eielson.atmo.2022$AirPressure)
eielson.atmo.2022$AirPressure <- eielson.atmo.2022$AirPressure*3.38639 # converting from inHG to kPa
## conversion to elevation at each site
# MOOS elevation is 574 feet
# POKE 760.96 ft
# STRT 820 ft
# FRCH 601 ft
# VAUL 688.8 ft
eielson.atmo.2022.compare <- eielson.atmo.2022
eielson.atmo.2022.compare$sea_level_pressure <- as.numeric(eielson.atmo.2022.compare$sea_level_pressure)
eielson.atmo.2022.compare$mmHG <- eielson.atmo.2022.compare$sea_level_pressure * 25.44 # converting to mmHG
# MOOS
eielson.atmo.2022.compare$mmHGcorrectedMOOS <- eielson.atmo.2022.compare$mmHG - (2.5*574/100)
eielson.atmo.2022.compare$AirPressureCorrectedMOOS <- eielson.atmo.2022.compare$mmHGcorrectedMOOS * 0.133322 # converting this to kPA to compare with MOOS PT
# POKE
eielson.atmo.2022.compare$mmHGcorrectedPOKE <- eielson.atmo.2022.compare$mmHG - (2.5*760.96/100)
eielson.atmo.2022.compare$AirPressureCorrectedPOKE <- eielson.atmo.2022.compare$mmHGcorrectedPOKE * 0.133322 # converting this to kPA
# STRT
eielson.atmo.2022.compare$mmHGcorrectedSTRT <- eielson.atmo.2022.compare$mmHG - (2.5*820/100)
eielson.atmo.2022.compare$AirPressureCorrectedSTRT <- eielson.atmo.2022.compare$mmHGcorrectedSTRT * 0.133322 # converting this to kPA
# FRCH
eielson.atmo.2022.compare$mmHGcorrectedFRCH <- eielson.atmo.2022.compare$mmHG - (2.5*601/100)
eielson.atmo.2022.compare$AirPressureCorrectedFRCH <- eielson.atmo.2022.compare$mmHGcorrectedFRCH * 0.133322 # converting this to kPA
# VAUL
eielson.atmo.2022.compare$mmHGcorrectedVAUL <- eielson.atmo.2022.compare$mmHG - (2.5*688.8/100)
eielson.atmo.2022.compare$AirPressureCorrectedVAUL <- eielson.atmo.2022.compare$mmHGcorrectedVAUL * 0.133322 # converting this to kPA
# Load in water pressure data
# urls
moos.atmo.2022.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ7QMNWjVX1R43qflIW7lVqkj7wRHouhgQhWK76kfR8zK-UZg9bFSm92ccPy8T0luhFHKwsLNQQjA56/pub?output=csv"
moos.stream.one.2022.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vRo04g32Yr3DsZbXQiw6VTPfgWuWq5csh1VhxfMy3IT3U6OkJOGvTlofjXwFfugiaRVJ34pPnOUZ3te/pub?output=csv"
moos.stream.two.2022.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vQRXmAtoP_7I2RYEDZrdCT1LDyD8W3Thjst549srxdlWDMUYUyBjiGABd8pgtZE9Efa8b4Vgb3qtyoc/pub?output=csv"
# load in data
moos.atmo.2022 <- read.csv(url(moos.atmo.2022.url), skip = 1)
moos.stream.one.2022 <- read.csv(url(moos.stream.one.2022.url), skip = 1)
moos.stream.two.2022 <- read.csv(url(moos.stream.two.2022.url), skip = 1)
# cleaning df to be able to interpret and merge
moos.atmo.2022 <- moos.atmo.2022[, -c(5:11)] # removing columns that aren't date/abs pressure and temp
moos.stream.one.2022 <- moos.stream.one.2022[, -c(5:13)] # removing columns that aren't date/abs pressure and temp
moos.stream.two.2022 <- moos.stream.two.2022[, -c(5:13)] # removing columns that arent date/abs pressure and temp
# changing datetime to AK time
moos.atmo.2022$DateTimeAK <- mdy_hms(moos.atmo.2022$Date.Time..GMT.08.00)
moos.stream.one.2022$DateTimeAK <- mdy_hms(moos.stream.one.2022$Date.Time..GMT.08.00)
moos.stream.two.2022$DateTimeAK <- mdy_hms(moos.stream.two.2022$Date.Time..GMT.08.00)
# round date to 5 minute intervals
moos.atmo.2022$DateTimeAK <- lubridate::round_date(moos.atmo.2022$DateTimeAK, "5 minutes")
moos.stream.one.2022$DateTimeAK <- lubridate::round_date(moos.stream.one.2022$DateTimeAK, "5 minutes")
moos.stream.two.2022$DateTimeAK <- lubridate::round_date(moos.stream.two.2022$DateTimeAK, "5 minutes")
# changing the names
# cleaning off original datetime
moos.atmo.2022 <- moos.atmo.2022[, -c(2)] # removing columns that aren't date/abs pressure and temp
moos.stream.one.2022 <- moos.stream.one.2022[, -c(2)] # removing columns that aren't date/abs pressure and temp
moos.stream.two.2022 <- moos.stream.two.2022[, -c(2)] # removing columns that arent
names(moos.atmo.2022) <- c("Site", "AirPressure", "TempC", "DateTimeAK")
names(moos.stream.one.2022) <- c("Site", "WaterPressure", "TempC", "DateTimeAK")
names(moos.stream.two.2022) <- c("Site", "WaterPressure", "TempC",  "DateTimeAK")
moos.atmo.2022 %>% filter(AirPressure > 96.8) %>% ggplot(aes(x = DateTimeAK, y = AirPressure)) +
geom_point()
# cleaning erroneous points
moos.atmo.2022 <- moos.atmo.2022 %>%
mutate(across(c(AirPressure),
~ifelse(DateTimeAK <= "2022-06-01" & AirPressure < 97.5, NA, .))) %>% filter(AirPressure > 96.5)
moos.atmo.2022 <- moos.atmo.2022 %>%
mutate(across(c(AirPressure),
~ifelse(DateTimeAK >= "2022-05-15" & DateTimeAK <= "2022-05-20" & AirPressure < 98.2, NA, .)))
moos.atmo.2022 <- moos.atmo.2022 %>%
mutate(across(c(AirPressure),
~ifelse(DateTimeAK >= "2022-05-18" & DateTimeAK <= "2022-05-20" & AirPressure < 99.1, NA, .)))
moos.atmo.2022 <- moos.atmo.2022 %>%
mutate(across(c(AirPressure),
~ifelse(DateTimeAK >= "2022-08-10" & DateTimeAK <= "2022-08-12" & AirPressure > 99.5, NA, .)))
moos.atmo.2022 <- moos.atmo.2022 %>%
mutate(across(c(AirPressure),
~ifelse(DateTimeAK >= "2022-08-10" & DateTimeAK <= "2022-08-12" & AirPressure < 99, NA, .)))
moos.atmo.2022 <- moos.atmo.2022 %>%
mutate(across(c(AirPressure),
~ifelse(DateTimeAK >= "2022-08-10" & AirPressure < 96.8, NA, .)))
moos.atmo.2022 <- moos.atmo.2022 %>% filter(DateTimeAK <= "2022-10-10 12:30:00") %>% mutate(across(c(AirPressure),
~ifelse(DateTimeAK >= "2022-10-3"& DateTimeAK <= "2022-10-8" & AirPressure < 98.5, NA, .)))
moos.atmo.2022 <- moos.atmo.2022 %>% mutate(across(c(AirPressure),
~ifelse(DateTimeAK >= "2022-10-2"& DateTimeAK <= "2022-10-3" & AirPressure < 98, NA, .)))
moos.atmo.2022 %>% filter(DateTimeAK <= "2022-10-15" & DateTimeAK >= "2022-10-01") %>% ggplot(aes(x = DateTimeAK, y = AirPressure)) +
geom_point()
moos.atmo.2022 %>% ggplot(aes(x = DateTimeAK, y = AirPressure)) +
geom_point()
moos.atmo.2022.compare <- moos.atmo.2022
atmo.pt.2022.1 <- left_join(eielson.atmo.2022.compare, moos.atmo.2022.compare, by = "DateTimeAK")
atmo.pt.2022.1 %>% filter(DateTimeAK >= "2022-05-01" & DateTimeAK <= "2022-05-15") %>% ggplot(aes(x = DateTimeAK, y = AirPressureCorrectedMOOS)) +
geom_line(aes(x=DateTimeAK, y=AirPressureCorrectedMOOS), color="#A6CEE3") +
geom_line(aes(x=DateTimeAK, y=AirPressure.x), color="#FF7F00") +
geom_line(aes(x=DateTimeAK, y=AirPressure.y), color = "red") +
theme_classic() +
ggtitle("Eielson Corrected(blue) & Eielson uncorrected(orange) & MOOS(red) Atmo P")
ggplot(moos.stream.two.2022, aes(x = DateTimeAK, y = WaterPressure)) +
geom_point() +
theme_classic()
# adjusting/cleaning moos.stream.two
moos.stream.two.2022.b <- moos.stream.two.2022
moos.stream.two.2022 <- moos.stream.two.2022 %>%
mutate(across(c(WaterPressure),
~ifelse(DateTimeAK >= "2022-05-09" & DateTimeAK <= "2022-05-25", NA, .))) # PT wasnt placed into the stream until 5/25
moos.stream.two.2022 <- moos.stream.two.2022 %>%
mutate(across(c(WaterPressure),
~ifelse(DateTimeAK >= "2022-06-01" & DateTimeAK <= "2022-07-01" & WaterPressure < 101, NA, .))) %>% filter(WaterPressure > 90)
# shifting the step change
moos.2.before <- moos.stream.two.2022[c(1:3817), ] # 6/7 @ 14:05 we cleaned the PVC housing so we are shifting the previous data up to match after the cleaning
moos.2.after <- moos.stream.two.2022[c(3818:40000), ]
moos.stream.two.2022[3818, 2] - moos.stream.two.2022[3817, 2] # 3.573
moos.2.before$WaterPressure <- moos.2.before[, 2] + 3.573
moos.stream.two.2022 <- full_join(moos.2.before, moos.2.after)
moos.2.before2 <- moos.stream.two.2022[c(1:25434), ]
moos.2.mid2 <- moos.stream.two.2022[c(25435:33497), ]
moos.2.after2 <- moos.stream.two.2022[c(33498:40000), ]
moos.stream.two.2022[25435, 2] - moos.stream.two.2022[25434, 2]  # 10.926
moos.2.mid2$WaterPressure <- moos.2.mid2[, 2] - 10.926
moos.stream.two.2022.2 <- full_join(moos.2.before2, moos.2.mid2)
moos.stream.two.2022 <- full_join(moos.stream.two.2022.2, moos.2.after2)
## Bring the last chunk up half way?
moos.2.before3 <- moos.stream.two.2022[c(1:17096), ]
moos.2.after3 <- moos.stream.two.2022[c(17097:40000), ]
moos.stream.two.2022[17096, 2] - moos.stream.two.2022[17097, 2] # 5.389
moos.2.after3$WaterPressure <- moos.2.after3[, 2] + 5.389/2
moos.stream.two.2022 <- full_join(moos.2.before3, moos.2.after3)
moos.stream.two.2022 <- moos.stream.two.2022 %>% filter(DateTimeAK < "2022-07-31" | DateTimeAK > "2022-08-02 16:45:00") %>% filter(DateTimeAK <= "2022-10-08 08:15:00") %>% filter(!DateTimeAK %in% c("2022-09-20 20:00:00", "2022-09-21 00:00:00")) %>% filter(DateTimeAK <= "2022-09-28 14:00:00" | DateTimeAK >= "2022-09-28 14:25:00")
# shifting small step change
moos.2.before4 <- moos.stream.two.2022[c(1:5144), ]
moos.2.after4 <- moos.stream.two.2022[c(5145:40000), ]
moos.stream.two.2022[5145, 2] - moos.stream.two.2022[5144, 2] # 0.365
moos.2.after4$WaterPressure <- moos.2.after4[, 2] - 0.365
moos.stream.two.2022 <- full_join(moos.2.before4, moos.2.after4)
# shifting small step change
moos.2.before5 <- moos.stream.two.2022[c(1:33379), ]
moos.2.after5 <- moos.stream.two.2022[c(33384:40000), ]
moos.stream.two.2022[33379, 2] - moos.stream.two.2022[33384, 2] # 0.228
moos.2.after5$WaterPressure <- moos.2.after5[, 2] - 0.228
moos.stream.two.2022 <- full_join(moos.2.before5, moos.2.after5)
moos.stream.two.2022 %>%
#filter(DateTimeAK > "2022-09-28" & DateTimeAK < "2022-09-29") %>%
ggplot(aes(x = DateTimeAK, y = WaterPressure)) +
geom_point() +
theme_classic()
# Final water pressure
moos.final.pressure.2022 <- moos.stream.two.2022
moos.final.pressure.2022 <- moos.final.pressure.2022[,-c(3,5,7)] # removing columns that are unnecessary. I only need both water pressures and mean pressure with a DateTime column
eielson.atmo.2022 <- eielson.atmo.2022[,-c(1,3)] # i dont need site, Temp and sea_level_pressure column
eielson.atmo.2022.compare <-  eielson.atmo.2022.compare[ , -which(names(eielson.atmo.2022.compare) %in% c("Site","TempC", "sea_level_pressure", "AirPressure", "mmHG", "mmHGcorrectedMOOS","mmHGcorrectedPOKE","mmHGcorrectedSTRT","mmHGcorrectedFRCH","mmHGcorrectedVAUL"))] # removing columns I do not need
# Fill gap during end of July for our pressure data with Eielson data
atmo.pt.2022.1$moos.combo <- ifelse(atmo.pt.2022.1$DateTimeAK > "2022-07-23 17:15:00" & atmo.pt.2022.1$DateTimeAK < "2022-08-02 17:00:00", atmo.pt.2022.1$AirPressureCorrectedMOOS, atmo.pt.2022.1$AirPressure.y)
# Remove outliers
atmo.pt.2022.1 <- atmo.pt.2022.1 %>%
mutate(across(c(moos.combo),
~ifelse(DateTimeAK >= "2022-09-10" & DateTimeAK <= "2022-09-11" & moos.combo < 98.5, NA, .)))
atmo.pt.2022.1 %>% filter(DateTimeAK > "2022-05-15") %>%
#filter(DateTimeAK > "2022-06-01" & DateTimeAK < "2022-09-01") %>%
ggplot(aes(DateTimeAK, AirPressureCorrectedMOOS)) + geom_point() #+ geom_vline(xintercept = as.POSIXct("2022-09-10")) + geom_vline(xintercept = as.POSIXct("2022-09-12"))
#join the atmospheric and water pressure together
MOOS.2022 <- left_join(atmo.pt.2022.1, moos.final.pressure.2022, by = "DateTimeAK")
# Water pressure - atmospheric pressure
MOOS.2022$difference <- MOOS.2022$WaterPressure - MOOS.2022$AirPressureCorrectedMOOS
MOOS.2022 %>% filter(DateTimeAK > "2022-05-15") %>%
#filter(DateTimeAK > "2022-09-18" & DateTimeAK < "2022-09-22") %>%
ggplot(aes(DateTimeAK, WaterPressure)) + geom_point() + geom_point(aes(DateTimeAK, AirPressureCorrectedMOOS)) #+ geom_vline (xintercept = as.POSIXct("2022-09-20 20:00:00"))
# Plot difference
MOOS.2022 %>% filter(DateTimeAK > "2022-05-20") %>%
ggplot(aes(DateTimeAK, difference)) + geom_point()
#MOOS.2022 %>% filter(DateTimeAK > "2022-09-01" & DateTimeAK < "2022-10-15") %>% filter(difference > 5) %>% View()
### Plot MOOS measured Q
QSummary.MO.2022 <- QSummary.2022 %>% filter(Site =="MOOS")
ggplot(QSummary.MO.2022) +
geom_point(aes(x = DateTimeAK, y = MeasuredQ_Ls, shape = Method, color = Site), size=3) +
theme_classic() +
scale_color_manual(values=c("#A6761D")) +
ggtitle("MOOS")
# trying to merge by nearest date if we have an offset point
MOOS.2022.dt <- setDT(MOOS.2022)
MOOS.2022.dt <- subset(MOOS.2022.dt, DateTimeAK < "2022-10-19 14:00:00") %>% na.omit()# removing rows that had dates corresponding to end of record that messed up the rolling nearest function
QSummary.MO.2022.dt <- QSummary.MO.2022
Moose1comb.2022 <- MOOS.2022.dt[QSummary.MO.2022.dt, on = "DateTimeAK", roll = 'nearest']
# Remove outlier Q points
Moose1comb.2022 <- Moose1comb.2022 %>% filter(difference < 4 | MeasuredQ_Ls > 1000)
## ONLY using PT 2
MOOS1.lm.2022 <- lm(Moose1comb.2022$MeasuredQ_Ls ~ Moose1comb.2022$difference)
#summary(MOOS1.lm.2022)
# plot rating curve
moos.formula = y~x
ggplot(aes(x = difference, y = MeasuredQ_Ls), data = Moose1comb.2022) +
geom_point(aes(color = Method), size = 3) +
geom_smooth(method = "lm", se=FALSE, formula = moos.formula) +
stat_poly_eq(formula = moos.formula,
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = TRUE) +
theme_light() +
ggtitle("Moose all measured Q")
# Remove two low difference, high measured Q points
Moose1comb.2022 <- Moose1comb.2022 %>% filter(MeasuredQ_Ls < 1000 | MeasuredQ_Ls > 2000)
# plot rating curve
moos.formula = y~x
ggplot(aes(x = difference, y = MeasuredQ_Ls), data = Moose1comb.2022) +
geom_point(aes(color = Method), size = 3) +
geom_smooth(method = "lm", se=FALSE, formula = moos.formula) +
stat_poly_eq(formula = moos.formula,
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = TRUE) +
theme_light() +
ggtitle("Moose all measured Q")
## Predict MOOS Q
MOOS1.lm.2022 <- lm(Moose1comb.2022$MeasuredQ_Ls ~ Moose1comb.2022$difference)
MOOS.2022.dt$pred.moos1.Q <- coef(MOOS1.lm.2022)[2] * MOOS.2022.dt$difference+ coef(MOOS1.lm.2022)[1]
MOOS.2022.dt <- MOOS.2022.dt %>% select(DateTimeAK, pred.moos1.Q) %>% filter(DateTimeAK >= "2022-05-25 08:05:00" & DateTimeAK <= "2022-10-08 16:15:00")
MOOS.2022.dt <- na_kalman(MOOS.2022.dt)
MOOS.2022.dt %>% na.omit() %>% ggplot(aes(x = DateTimeAK, y = pred.moos1.Q)) +
geom_line(color="#A6CEE3", size=1.25) +
geom_point(data = Moose1comb.2022, aes(x = DateTimeAK, y = MeasuredQ_Ls, shape = Method), size=3) +
theme_classic() +
ggtitle("Moose predicted and measured Q") +
xlab("Date") +
ylab("Discharge (L/s)")
poke.stream.one.2022.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vR8p1pdbkQBMo54XaZinGwxyzojCnlkXeZid3EFvmt9v31PFvpsa1DlWClj8aG0kkJIuU57WXl-cq7Q/pub?output=csv"
poke.stream.two.2022.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vR-wJjf3rO8eC7bMpQZgwqFLHFQpf5qCInyWtUF1PqaCB8Z_EoM1cTHRUmWypjftREIx1rP0V6zYJxL/pub?output=csv"
# load in url
poke.stream.one.2022 <- read.csv(url(poke.stream.one.2022.url), skip = 1)
poke.stream.two.2022 <- read.csv(url(poke.stream.two.2022.url), skip = 1)
# cleaning df to be able to interpret and merge
poke.stream.one.2022 <- poke.stream.one.2022[, -c(5:18)] # removing columns that arent date/abs pressure and temp
poke.stream.two.2022 <- poke.stream.two.2022[, -c(5:9)] # removing columns that arent date/abs pressure and temp
# changing to AK time (It reads in as GMT but it is actually AKST )
poke.stream.one.2022$DateTimeAK <- mdy_hms(poke.stream.one.2022$Date.Time..GMT.08.00)
poke.stream.two.2022$DateTimeAK <- mdy_hms(poke.stream.two.2022$Date.Time..GMT.08.00)
# round date to 5 minute intervals
poke.stream.one.2022$DateTimeAK <- lubridate::round_date(poke.stream.one.2022$DateTimeAK, "5 minutes")
poke.stream.two.2022$DateTimeAK <- lubridate::round_date(poke.stream.two.2022$DateTimeAK, "5 minutes")
# cleaning off original datetime
poke.stream.one.2022 <- poke.stream.one.2022[, -c(2)] # removing columns that aren't date/abs pressure and temp
poke.stream.two.2022 <- poke.stream.two.2022[, -c(2)] # removing columns that arent
names(poke.stream.one.2022) <- c("Site", "WaterPressure", "TempC", "DateTimeAK")
names(poke.stream.two.2022) <- c("Site", "WaterPressure", "TempC", "DateTimeAK")
ggplot(poke.stream.one.2022, aes(x = DateTimeAK, y = WaterPressure))+
geom_point() +
theme_classic()
#poke.stream.one.2022.b <- poke.stream.one.2022
poke.stream.one.2022 <- poke.stream.one.2022.b
#adjusting/cleaning poke.stream.one
poke.stream.one.2022 <- poke.stream.one.2022 %>%
mutate(across(c(WaterPressure),
~ifelse(DateTimeAK >= "2022-05-09" & DateTimeAK <= "2022-05-18", NA, .))) # PT wasnt placed into the stream until 5/17
poke.stream.one.2022 <- poke.stream.one.2022 %>%
mutate(across(c(WaterPressure),
~ifelse(DateTimeAK >= "2022-08-27" & DateTimeAK <= "2022-08-31" & WaterPressure < 98.3, NA, .))) %>% filter( DateTimeAK <= "2022-10-07 15:30:00")
poke.stream.one.2022 <- poke.stream.one.2022 %>%
mutate(across(c(WaterPressure),
~ifelse(DateTimeAK >= "2022-10-05" & DateTimeAK <= "2022-10-07" & WaterPressure < 98, NA, .)))
poke.stream.one.2022 <- poke.stream.one.2022 %>%
mutate(across(c(WaterPressure),
~ifelse(DateTimeAK >= "2022-10-05" & DateTimeAK <= "2022-10-07" & WaterPressure < 98, NA, .))) %>%
filter(DateTimeAK > "2022-08-01 16:15:00" | DateTimeAK < "2022-08-01 00:00:00") %>%
filter(DateTimeAK != "2022-08-07 19:00:00")
# shifting small step change
poke.2.before <- poke.stream.one.2022[c(1:16756), ]
poke.2.after <- poke.stream.one.2022[c(16758:40000), ]
poke.stream.one.2022[16756, 2] - poke.stream.one.2022[16758, 2] # 0.39
poke.2.after$WaterPressure <- poke.2.after[, 2] + 0.39
poke.stream.one.2022 <- full_join(poke.2.before, poke.2.after)
# shifting larger step change
poke.1.before2 <- poke.stream.one.2022[c(1:8125), ]
poke.1.after2 <- poke.stream.one.2022[c(8150:40000), ]
poke.stream.one.2022[8150, 2] - poke.stream.one.2022[8125, 2] # 1.55
poke.1.after2$WaterPressure <- poke.1.after2[, 2] + 1.55
poke.stream.one.2022 <- full_join(poke.1.before2, poke.1.after2)
poke.stream.one.2022 %>% #filter(DateTimeAK > "2022-08-07" & DateTimeAK < "2022-08-15") %>%
ggplot(aes(x = DateTimeAK, y = WaterPressure))+
geom_point() +
theme_classic()
poke.stream.two.2022 <- poke.stream.two.2022 %>%
mutate(across(c(WaterPressure),
~ifelse(DateTimeAK >= "2022-09-17" & WaterPressure < 98, NA, .))) %>%
filter(DateTimeAK <= "2022-10-07 15:35:00")
poke.stream.two.2022 %>% ggplot(aes(x = DateTimeAK, y = WaterPressure))+
geom_point() +
theme_classic()
# merge to one
poke.final.pressure.2022 <- left_join(poke.stream.one.2022, poke.stream.two.2022, by = c("DateTimeAK"))
poke.final.pressure.2022$MeanPressure <- rowMeans(poke.final.pressure.2022[,c(2,6)], na.rm = TRUE)
poke.final.pressure.2022 %>% ggplot() + geom_point(aes(DateTimeAK, WaterPressure.x)) + geom_point(aes(DateTimeAK, WaterPressure.y), color = "red", cex = 0.5)
## Use PT1 before August 1st and PT2 after August 1st
# Shift PT2 up to match August PT1
poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-08-01" & DateTimeAK < "2022-08-15") %>% summarise(mean(WaterPressure.x - WaterPressure.y)) #2.62398
poke.final.pressure.2022 <- poke.final.pressure.2022 %>%
mutate(WaterPressure.merged = ifelse(DateTimeAK <= "2022-08-01", WaterPressure.x, WaterPressure.y))
# September step change
poke.before <- poke.final.pressure.2022[c(1:37665), ]
poke.after <- poke.final.pressure.2022[c(37705:40000), ]
poke.final.pressure.2022[37705, 9] - poke.final.pressure.2022[37665, 9] # 0.374
poke.after$WaterPressure.merged <- poke.after[, 9] + 0.374
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
# End of August step change... move after data down all the way?
poke.before <- poke.final.pressure.2022[c(1:29616), ]
poke.after <- poke.final.pressure.2022[c(29628:40000), ]
poke.final.pressure.2022[29628, 9] - poke.final.pressure.2022[29616, 9] # 1.037
poke.after$WaterPressure.merged <- poke.after[, 9] - 1.037
poke.final.pressure.2022 <- rbind(poke.before, poke.after)
poke.final.pressure.2022 %>% #filter(DateTimeAK > "2022-08-29" & DateTimeAK < "2022-08-29 17:00:00") %>%
ggplot() + geom_point(aes(DateTimeAK, WaterPressure.merged))
#poke.final.pressure.2022 %>% filter(DateTimeAK > "2022-06-05" & DateTimeAK < "2022-06-06 17:00:00") %>% View()
