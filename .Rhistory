moos.final.discharge <- left_join(Moose1comb, Moose2comb, by = c("DateTime"))
moos.final.discharge$MeanDischarge <- rowMeans(moos.final.discharge[,c('Moose1comb.pred.moos1.Q', 'Moose2comb.pred.moos2.Q')], na.rm = TRUE)
colnames(moos.final.discharge)
moos.final.discharge$MeanDischarge <- rowMeans(moos.final.discharge[,c(13,25)], na.rm = TRUE)
nrow(moos.final.discharge)
colnames(moos.final.discharge)
moos.final.discharge <- moos.final.discharge[,-c(2:4, 6:12, 14:24)]
colnames(moos.final.discharge)
moos.final <- ggplot(aes(x = DateTime, y = pred.moos1.Q), data = Moose1comb) +
geom_line(aes(x = DateTime, y = pred.moos1.Q), data = Moose1comb, color="#A6CEE3", size=1.25) +
geom_line(aes(x = DateTime, y = pred.moos2.Q), data = Moose2comb,color="#1F78B4", size=1.25, alpha = 0.75) +
geom_line(aes(x = Moose2comb.DateTime, y = MeanDischarge), data = moos.final.discharge, color = "red", size = 1.25, alpha = 0.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls), size=2) +
theme_classic() +
ylim(0, 3500) +
ggtitle("Moose1(light) & Moose2(dark) predicted all measured Q") +
ylab("Predicted discharge L/s") +
xlab("Time")
moos.final
moos.final <- ggplot(aes(x = DateTime, y = pred.moos1.Q), data = Moose1comb) +
geom_line(aes(x = DateTime, y = pred.moos1.Q), data = Moose1comb, color="#A6CEE3", size=1.25) +
geom_line(aes(x = DateTime, y = pred.moos2.Q), data = Moose2comb,color="#1F78B4", size=1.25, alpha = 0.75) +
geom_line(aes(x = DateTime, y = MeanDischarge), data = moos.final.discharge, color = "red", size = 1.25, alpha = 0.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls), size=2) +
theme_classic() +
ylim(0, 3500) +
ggtitle("Moose1(light) & Moose2(dark) predicted all measured Q") +
ylab("Predicted discharge L/s") +
xlab("Time")
moos.final
### POKE ###
# PT1 #
Poke1comb$pred.poke1.Q <- coef(POKE1.lm)[2] * Poke1comb$WaterLevel+ coef(POKE1.lm)[1]
ggplot(aes(x = DateTime, y = pred.poke1.Q), data = Poke1comb) +
geom_line(color="#A6CEE3", size=1.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls, shape = Method), size=3) +
theme_classic() +
ggtitle("Poker1 predicted all measured Q") +
xlab("Date") +
ylab("Predicted Discharge")
# PT2 #
Poke2comb$pred.poke2.Q <- coef(POKE2.lm)[2] * Poke2comb$WaterLevel+ coef(POKE2.lm)[1]
ggplot(aes(x = DateTime, y = pred.poke2.Q), data = Poke2comb) +
geom_line(color="#A6CEE3", size=1.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls, shape = Method), size=3) +
theme_classic() +
ggtitle("Poker") +
scale_shape_discrete(name = "Method", labels = c("Wading Rod", "Salt Dilution", "")) +
xlab("") +
ylab("Discharge(L/s)") +
scale_x_datetime(limits = as_datetime(c("2020-05-15", "2020-10-10")))
# POKE
poke.final.discharge <- data.frame(Poke1comb$Site, Poke1comb$DateTime, Poke1comb$pred.poke1.Q, Poke2comb$pred.poke2.Q)
nrow(poke.final.discharge)
poke.final.discharge$MeanDischarge <- rowMeans(poke.final.discharge[,c('Poke1comb.pred.poke1.Q', 'Poke2comb.pred.poke2.Q')], na.rm = TRUE)
poke.final.discharge <- poke.final.discharge[,-(3:4)]
nrow(poke.final.discharge)
### Poker1 (light blue) and Poker2 (dark blue) with observed Q.
poke.final <- ggplot(aes(x = DateTime, y = pred.poke1.Q), data = Poke1comb) +
geom_line(aes(x = DateTime, y = pred.poke1.Q), data = Poke1comb, color="#A6CEE3", size=1.25) +
geom_line(aes(x = DateTime, y = pred.poke2.Q), data = Poke2comb,color="#1F78B4", size=1.25, alpha = 0.75) +
geom_line(aes(x = Poke1comb.DateTime, y = MeanDischarge), data = poke.final.discharge, color = "red", size = 1.25, alpha = 0.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls), size=2) +
theme_classic() +
ylim(0, 3000) +
ggtitle("Poker1(light) & Poker2(dark) predicted all measured Q") +
ylab("Predicted discharge L/s") +
xlab("Time")
### STRT ###
# PT1 #
Strt1comb$pred.strt1.Q <- coef(STRT1.lm)[2] * Strt1comb$WaterLevel+ coef(STRT1.lm)[1]
ggplot(aes(x = DateTime, y = pred.strt1.Q), data = Strt1comb) +
geom_line(color="#A6CEE3", size=1.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls, shape = Method), size=3) +
theme_classic() +
ggtitle("Stuart") +
scale_shape_discrete(name = "Method", labels = c("Wading Rod", "Salt Dilution", "")) +
xlab("") +
ylab("Discharge (L/s)") +
scale_x_datetime(limits = as_datetime(c("2020-05-15", "2020-10-09")))
# PT2 #
Strt2comb$pred.strt2.Q <- coef(STRT2.lm)[2] * Strt2comb$WaterLevel+ coef(STRT2.lm)[1]
ggplot(aes(x = DateTime, y = pred.strt2.Q), data = Strt2comb) +
geom_line(color="#A6CEE3", size=1.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls, shape = Method), size=3) +
theme_classic() +
ggtitle("Stuart2 predicted all measured Q") +
scale_shape_discrete(name = "Method", labels = c("Wading Rod", "Salt Dilution", "")) +
xlab("Date") +
ylab("Predicted Discharge")
# Final STRT #
strt.final.discharge <- data.frame(Strt1comb$Site, Strt1comb$DateTime, Strt1comb$pred.strt1.Q)
strt.final.discharge <- strt.final.discharge %>% subset(strt.stream.one$DateTime > "2020-06-16")
nrow(strt.stream.one)
nrow(strt.final.discharge)
ggplot(aes(x = DateTime, y = pred.strt1.Q), data = Strt1comb) +
geom_line(aes(x = DateTime, y = pred.strt1.Q), data = Strt1comb, color="#A6CEE3", size=1.25) +
geom_line(aes(x = DateTime, y = pred.strt2.Q), data = Strt2comb,color="#1F78B4", size=1.25, alpha = 0.75) +
geom_line(aes(x = Strt1comb.DateTime, y = Strt1comb.pred.strt1.Q), data = strt.final.discharge, color = "red", size = 1.25, alpha = 0.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls), size=2) +
theme_classic() +
ylim(0, 3000) +
ggtitle("Stuart1(light) & Stuart2(dark) predicted all measured Q") +
ylab("Predicted discharge L/s") +
xlab("Time")
### VAUL ###
# PT2 #
Vaul2comb$pred.vaul2.Q <- coef(VAUL2.lm)[2] * Vaul2comb$WaterLevel+ coef(VAUL2.lm)[1]
ggplot(aes(x = DateTime, y = pred.vaul2.Q), data = Vaul2comb) +
geom_line(color="#A6CEE3", size=1.25) +
geom_point(aes(x = DateTime, y = MeasuredQ_Ls, shape = Method), size=3) +
theme_classic() +
ggtitle("Vault") +
scale_shape_discrete(name = "Mehtod", labels = c("Wading Rod", "Salt Dilution", "")) +
xlab("") +
ylab("Discharge (L/s)") +
scale_x_datetime(limits = as_datetime(c("2020-05-15", "2020-10-10")))
# Final VAUL #
vaul.final.discharge <- data.frame(Vaul2comb$Site, Vaul2comb$DateTime, Vaul2comb$pred.vaul2.Q)
vaul.final.discharge <- vaul.final.discharge %>%  subset(vaul.stream$DateTime > "2020-06-16")
nrow(vaul.final.discharge)
head(vaul.final.discharge)
head(vaul.stream)
plot(x = vaul.stream$DateTime, y = vaul.stream$WaterLevel) # plot check
### Filter Vault ###
QSummary.VA <- QSummary %>% filter(Site =="VAUL") %>% filter(MeasuredQ_Ls < 2000)
### Rating curve for VAUL PT2 ###
vaul.stream$Site <- "VAUL"
Vaul2comb <- full_join(vaul.stream, QSummary.VA)
VAUL2.lm <- lm(Vaul2comb$MeasuredQ_Ls ~ Vaul2comb$WaterLevel)
vaul.formula <- y ~ x
vrc.1 <- ggplot(aes(x = WaterLevel, y = MeasuredQ_Ls), data = Vaul2comb) +
geom_point(aes(color = Method), size = 3) +
geom_smooth(method = "lm", se=FALSE) +
stat_poly_eq(formula = vaul.formula,
aes(label = paste(..eq.label.., ..rr.label.., sep = "~~~")),
parse = TRUE) +
xlim(197.5, 198.5) +
ylim(0, 1500) +
theme_classic() +
ggtitle("Vault2 all measured Q")
vrc.1
head(Vaul2comb)
# Final VAUL #
vaul.final.discharge <- data.frame(Vaul2comb$Site, Vaul2comb$DateTime, Vaul2comb$pred.vaul2.Q)
### Write CSV ###
write.csv(frch.final.discharge,"Predicted_Discharge/processed/FRCH.csv", row.names = FALSE)
write.csv(moos.final.discharge,"Predicted_Discharge/processed/MOOS.csv", row.names = FALSE)
write.csv(poke.final.discharge,"Predicted_Discharge/processed/POKE.csv", row.names = FALSE)
write.csv(strt.final.discharge,"Predicted_Discharge/processed/STRT.csv", row.names = FALSE)
write.csv(vaul.final.discharge,"Predicted_Discharge/processed/VAUL.csv", row.names = FALSE)
### Rename Columns ###
names(frch.final.discharge) <- c("Site", "DateTime", "MeanDischarge")
names(moos.final.discharge) <- c("Site", "DateTime", "MeanDischarge")
names(poke.final.discharge) <- c("Site", "DateTime", "MeanDischarge")
names(strt.final.discharge) <- c("Site", "DateTime", "MeanDischarge")
names(vaul.final.discharge) <- c("Site", "DateTime", "MeanDischarge")
nrow(moos.final.discharge)
moos.final.discharge <- na.omit(moos.final.discharge) # cleaning NaN in data set
nrow(moos.final.discharge)
poke.final.discharge <- na.omit(poke.final.discharge) # cleaning NaN in data set
nrow(poke.final.discharge)
final_discharge_2020 <- rbind(frch.final.discharge, moos.final.discharge,
poke.final.discharge, strt.final.discharge,
vaul.final.discharge)
colnames(frch.final.discharge)
colnames(moos.final.discharge)
moos.final.discharge <- moos.final.discharge[,-(4:5)]
colnames(moos.final.discharge)
names(poke.final.discharge) <- c("Site", "DateTime", "MeanDischarge")
names(strt.final.discharge) <- c("Site", "DateTime", "MeanDischarge")
names(vaul.final.discharge) <- c("Site", "DateTime", "MeanDischarge")
final_discharge_2020 <- rbind(frch.final.discharge, moos.final.discharge,
poke.final.discharge, strt.final.discharge,
vaul.final.discharge)
write.csv(final_discharge_2020,"Predicted_Discharge/processed/All_Sites.csv", row.names = FALSE)
Q_2020 <- final_discharge_2020
Q_2020$day = format(as.POSIXct(Q_2020$DateTime,format="%Y-%m-%d %H:%M:%S"),format="%Y-%m-%d")
Q_2020$day = as.POSIXct(Q_2020$day, "%Y-%m-%d", tz="America/Anchorage")
Q_2020$DateTime = NULL
Q.daily = with(Q_2020, tapply(MeanDischarge, list(day, Site), mean))
Q.daily = as.data.frame(Q.daily)
library(readr)
library(ggplot2)
library(dplyr)
library(lubridate)
library(RColorBrewer)
library(gridExtra)
### Import Data ###
strt.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vT05dgyg07MOSVdaEFFywTuktj7TTY0ukYjp5ZckRTP5BJ9dFaq5fT0MppdTchBJseTlLSzoyuLbWNS/pub?output=csv"
frch.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vSXjY8hE7y3xpQs42ce8tTuqxadD-9GSLdlzmlzapcdxZoYwZ0M3GOjrQfKshj5Cw1XlPMICGK2v51L/pub?output=csv"
vaul.url <- "https://docs.google.com/spreadsheets/d/e/2PACX-1vTd-IH6XcwWpzDQav6eQO5NBzV2XB3XzCwJdxHarSiOniu57EoqegV8vU4eF8bo_8REcr8SxsXaDMpR/pub?output=csv"
strt.gauge <- read.csv(url(strt.url), skip = 1)
frch.gauge <- read.csv(url(frch.url), skip = 1)
vaul.gauge <- read.csv(url(vaul.url), skip = 1)
### Rename columns ###
names(strt.gauge) <- c("Site", "DateTimeGMT", "Precip")
names(frch.gauge) <- c("Site", "DateTimeGMT", "Precip")
names(vaul.gauge) <- c("Site", "DateTimeGMT", "Precip")
strt.gauge$Site <- "STRT"
frch.gauge$Site <- "FRCH"
vaul.gauge$Site <- "VAUL"
# Input NA for missing time #
strt.gauge$DateTimeGMT[strt.gauge$DateTimeGMT == ""] <- NA
frch.gauge$DateTimeGMT[frch.gauge$DateTimeGMT == ""] <- NA
vaul.gauge$DateTimeGMT[vaul.gauge$DateTimeGMT == ""] <- NA
# Convert time and put in AK time #
strt.gauge$DateTime <- mdy_hms(strt.gauge$DateTimeGMT, tz = "GMT")
attributes(strt.gauge$DateTime)$tzone <- 'America/Anchorage'
frch.gauge$DateTime <- mdy_hms(frch.gauge$DateTimeGMT, tz = "GMT")
attributes(frch.gauge$DateTime)$tzone <- 'America/Anchorage'
vaul.gauge$DateTime <- mdy_hms(vaul.gauge$DateTimeGMT, tz = "GMT")
attributes(vaul.gauge$DateTime)$tzone <- 'America/Anchorage'
# Plot data #
STRT <- ggplot(strt.gauge) +
geom_line(aes(x = DateTime, y = Precip)) +
xlab("Date") +
ylab("Cumulative Precipitation in mm") +
ggtitle("Stuart Rain Gauge")
STRT
FRCH <- ggplot(frch.gauge) +
geom_line(aes(x = DateTime, y = Precip)) +
xlab("Date") +
ylab("Cumulative Precipitation in mm") +
ggtitle("French Rain Gauge")
FRCH
VAUL <- ggplot(vaul.gauge) +
geom_line(aes(x = DateTime, y = Precip)) +
xlab("Date") +
ylab("Cumulative Precipitation in mm") +
ggtitle("Vault Rain Gauge")
VAUL
## STRT ##
strt.gauge$inst_rainfall_mm = 0.2
## FRCH ##
frch.gauge$inst_rainfall_mm = 0.2
## VAUL ##
vaul.gauge$inst_rainfall_mm = 0.2
## STRT ##
min<-cut(strt.gauge$DateTime, breaks="15 min")
STRT.st <- as.data.frame(aggregate(inst_rainfall_mm ~ min, data = strt.gauge, FUN=function(x)
sum=sum(x)))
STRT.st$datetimeAK<-as.POSIXct(STRT.st$min, "%Y-%m-%d %H:%M:%S", tz="America/Anchorage")
## FRCH ##
min<-cut(frch.gauge$DateTime, breaks="15 min")
FRCH.st <- as.data.frame(aggregate(inst_rainfall_mm ~ min, data = frch.gauge, FUN=function(x)
sum=sum(x)))
FRCH.st$datetimeAK<-as.POSIXct(FRCH.st$min, "%Y-%m-%d %H:%M:%S", tz="America/Anchorage")
## VAUL ##
min<-cut(vaul.gauge$DateTime, breaks="15 min")
VAUL.st <- as.data.frame(aggregate(inst_rainfall_mm ~ min, data=vaul.gauge, FUN=function(x)
sum=sum(x)))
VAUL.st$datetimeAK<-as.POSIXct(VAUL.st$min, "%Y-%m-%d %H:%M:%S", tz="America/Anchorage")
#### round time to nearest 15 min ####
STRT.st$datetimeAK = lubridate::round_date(STRT.st$datetimeAK, "15 minutes")
FRCH.st$datetimeAK = lubridate::round_date(FRCH.st$datetimeAK, "15 minutes")
VAUL.st$datetimeAK = lubridate::round_date(VAUL.st$datetimeAK, "15 minutes")
par(mfrow=c(3,1))
plot(STRT.st$inst_rainfall_mm ~ STRT.st$datetimeAK, type="h",
xlim=c(as.POSIXct("2020-07-25 00:00:00"), as.POSIXct("2020-10-21 00:00:00")),
ylim=c(0,13))
plot(FRCH.st$inst_rainfall_mm ~ FRCH.st$datetimeAK, type="h",
xlim=c(as.POSIXct("2020-06-05 00:00:00"), as.POSIXct("2020-10-21 00:00:00")),
ylim=c(0,13))
plot(VAUL.st$inst_rainfall_mm ~ VAUL.st$datetimeAK, type="h",
xlim=c(as.POSIXct("2020-06-05 00:00:00"), as.POSIXct("2020-10-21 00:00:00")),
ylim=c(0,13))
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(plyr)
library(imputeTS)
library(TSA)
library(bbmle)
library(zoo)
library(xts)
library(forecast)
library(stats)
library(lattice)
library(nlme)
library(geosphere)
library(car)
library(EcoHydRology)
### Load from local machine ###
EXO_ALL <- read_csv("~/Documents/DoD_2020/EXO_data/from_internal_harddrive/processed/EXO.ALL.csv")
EXO_ALL$Site <- EXO_ALL$site.ID
EXO_ALL$DateTime <- as.POSIXct(EXO_ALL$DateTime)
ALL <- full_join(EXO_ALL, final_discharge_2020)
SUNA_ALL <- read_csv("~/Documents/DoD_2020/SUNA_data/from_internal_harddrive/processed/SUNA.processed.csv")
SUNA_ALL <- SUNA_ALL[, -(14:269)] # Remove channels
SUNA_ALL$Site <- SUNA_ALL$site.ID
SUNA_ALL$DateTime <- SUNA_ALL$datetimeAK
ALL <- full_join(ALL, SUNA_ALL)
#### subset data by site ####
FRCH <-  subset(ALL, Site == "FRCH")
head(FRCH$DateTime)
STRT = subset(ALL, Site == "STRT")
head(STRT$DateTime)
POKE = subset(ALL, Site == "POKE")
head(POKE$DateTime)
VAUL = subset(ALL, Site == "VAUL")
head(VAUL$DateTime)
MOOS = subset(ALL, Site == "MOOS")
head(MOOS$DateTime)
FRCH_Q = as.data.frame(Q.daily$FRCH)
FRCH_Q$day = as.Date(rownames(Q.daily))
names(FRCH_Q) = c("Discharge_Lsec", "day")
STRT_Q = as.data.frame(Q.daily$STRT)
STRT_Q$day = as.Date(rownames(Q.daily))
names(STRT_Q) = c("Discharge_Lsec", "day")
POKE_Q = as.data.frame(Q.daily$POKE)
POKE_Q$day = as.Date(rownames(Q.daily))
names(POKE_Q) = c("Discharge_Lsec", "day")
VAUL_Q = as.data.frame(Q.daily$VAUL)
VAUL_Q$day = as.Date(rownames(Q.daily))
names(VAUL_Q) = c("Discharge_Lsec", "day")
MOOS_Q = as.data.frame(Q.daily$MOOS)
MOOS_Q$day = as.Date(rownames(Q.daily))
names(MOOS_Q) = c("Discharge_Lsec", "day")
#### data wrangling - fill gaps ####
# fxn #
fillgaps15 = function(df, dat, datquotes, largegap.num){
## Document gaps >= largegap.num (1 largegap.num = 15 min) ##
# (note - the criteria of what constitutes a "large" gap should be reevaluated depending on the trend being characterized)
is.na.rle <- rle(is.na(dat))
is.na.rle$values <- is.na.rle$values & is.na.rle$lengths >= (largegap.num)
biggaps = df[inverse.rle(is.na.rle), ]
tz(biggaps$DateTime) = "America/Anchorage"
biggaps = subset(biggaps, select = "DateTime")
# Make univariate time series, covert to zoo, then to ts #
ts.xts = subset(df, select = c("DateTime",datquotes))
ts.xts<-read.zoo(ts.xts, index.column=1, format="%Y-%m-%d %H:%M:%S", tz="America/Anchorage")
ts.xts<-as.xts(ts.xts)
# remove leading and trailing NAs #
ts.xts = na.trim(ts.xts, is.na="any")
# Apply auto.arima and kalman filter to impute missing values #
fit2 = auto.arima(ts.xts)
kal = KalmanSmooth(ts.xts, fit2$model)
id.na<-which(is.na(ts.xts))
for(i in id.na)
ts.xts[i]<-fit2$model$Z %*% kal$smooth[i,]
# revert to dataframe #
ts.df = as.data.frame((ts.xts))
ts.df$date_timeAK = as.POSIXct(row.names(ts.df), tz="America/Anchorage")
names(ts.df) = c("dat_filled", "DateTime")
# remove large gaps #
ts.df$dat_filled[ts.df$date_timeAK %in% as.POSIXct(biggaps$DateTime)] = NA
# Replace large gaps with linear interpolation #
ts.df$dat_filled = na.interpolation(ts.df$dat_filled)
ts.df = subset(ts.df, select = c("dat_filled", "DateTime"))
return(ts.df)
}
### examine the recursive digital filter at .9, .925, .95 levels ###
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type = "l", xlab = "", ylab = "Q (L/sec)",
xlim =  as.POSIXct(c("2020-06-01 00:00:00","2020-10-15 00:00:00"), tz="America/Anchorage"),
ylim = c(0, 3000), col="blue")
#
FRCH_Q_bf = BaseflowSeparation(frch.final.discharge$MeanDischarge, filter_parameter = 0.90, passes = 3)
hydrograph(input=subset(FRCH_Q, select = c(day, Discharge_Lsec)), streamflow2=FRCH_Q_bf$bt)
### Storm 1 ###
# FRCH #
par(mar=c(1,1), bty = "n")
plot(FRCH$MeanDischarge ~ as.POSIXct(FRCH$datetimeAK, tz="America/Anchorage"), type="l", xlab="", ylab="Q (L/sec)",ylim = c(0,2000), col="blue", main="C3",
xlim = as.POSIXct(c("2020-06-12 01:00:00","2020-06-15 01:00:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
FRCH_bfQ_mn = mean(FRCH_Q_bf$bt)
FRCH_bfQ_mn
FRCH_bfQ_mn*2
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
plot(FRCH$MeanDischarge ~ as.POSIXct(FRCH$datetimeAK, tz="America/Anchorage"), type="l", xlab="", ylab="Q (L/sec)",ylim = c(0,2000), col="blue", main="C3",
xlim = as.POSIXct(c("2020-06-12 01:00:00","2020-06-15 01:00:00"), tz="America/Anchorage"))
par(mfrow=c(1,1))
plot(FRCH_Q$Discharge_Lsec ~ FRCH_Q$day, type="l", xlab="", ylab="Q (L/sec)",ylim = c(0,3000), col="blue", main="FRCH")
lines(FRCH_Q_bf$bt ~ FRCH_Q$day, col="red")
#lines((C3_Q_bf$bt*1.3) ~ C3_Q$day, col="red", lty=2)
#lines((C3_Q_bf$bt*5) ~ C3_Q$day, col="red", lty=2)
abline(h = FRCH_bfQ_mn*2, col="red", lty=2)
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2020-06-01 00:00:00","2020-10-15 00:00:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
### Import precipitation data into the *ALL document ###
# FRCH rain gauge installed on the 11th of June.
plot(FRCH.st$inst_rainfall_mm ~ FRCH.st$datetimeAK, type="h",
xlim = as.POSIXct(c("2020-06-05 0:00:00","2020-10-15 00:00:00"), tz="America/Anchorage"),
ylim = c(40,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'FRCH precip. (mm)')
### Import precipitation data into the *ALL document ###
# FRCH rain gauge installed on the 11th of June.
plot(FRCH.st$inst_rainfall_mm ~ FRCH.st$datetimeAK, type="h",
xlim = as.POSIXct(c("2020-06-05 0:00:00","2020-10-15 00:00:00"), tz="America/Anchorage"),
ylim = c(25,0),
axes=F, xlab="", ylab="")
axis(side = 4)
mtext(side = 4, line = 3, 'FRCH precip. (mm)')
lines(FRCH$nitrateuM ~ FRCH$DateTime, type="l", xlab="", ylab="", col="purple",
xlim = as.POSIXct(c("2020-06-05 00:00:00","2020-10-15 01:00:00"), tz="America/Anchorage"))
par(new = T)
plot(frch.gauge$Precip ~ frch.gauge$DateTime, type="h",
xlim = as.POSIXct(c("2020-06-11 0:00:00","2020-10-15 00:00:00"), tz="America/Anchorage"),
ylim = c(400,0),
axes=F, xlab="", ylab="")
plot(FRCH_Q$Discharge_Lsec ~ FRCH_Q$day, type="l", xlab="", ylab="Q (L/sec)",ylim = c(0,3000), col="blue", main="FRCH")
lines(FRCH_Q_bf$bt ~ FRCH_Q$day, col="red")
#lines((C3_Q_bf$bt*1.3) ~ C3_Q$day, col="red", lty=2)
#lines((C3_Q_bf$bt*5) ~ C3_Q$day, col="red", lty=2)
abline(h = FRCH_bfQ_mn*2, col="red", lty=2)
plot(FRCH$MeanDischarge ~ FRCH$DateTime, type="l", xlab="", ylab="Q (L/sec)",
xlim = as.POSIXct(c("2020-06-01 00:00:00","2020-10-15 00:00:00"), tz="America/Anchorage"))
abline(h=FRCH_bfQ_mn*2, col="red", lty=2)
abline(h=FRCH_bfQ_mn, col="red")
lines(FRCH$nitrateuM * 20 ~ FRCH.no3$DateTime, type="l", xlab="", ylab="", col="purple",
xlim = as.POSIXct(c("2020-06-01 00:00:00","2020-10-15 01:00:00"), tz="America/Anchorage"))
par(new = T)
### Import precipitation data into the *ALL document ###
# FRCH rain gauge installed on the 11th of June.
plot(FRCH.st$inst_rainfall_mm ~ FRCH.st$datetimeAK, type="h",
xlim = as.POSIXct(c("2020-06-05 0:00:00","2020-10-15 00:00:00"), tz="America/Anchorage"),
ylim = c(25,0),
axes=F, xlab="", ylab="")
lines(FRCH_Q_bf$bt*1.3 ~ FRCH_Q$day, col="red", lty = 2)
lines((FRCH_Q_bf$bt*5) ~ FRCH_Q$day, col="red", lty=2)
nrow(FRCH_Q_bf)
nrow(FRCH_Q)
View(FRCH_Q)
write.csv(FRCH_Q, "Predicted_Discharge/processed/FRCH_Q_2020.csv", row.names = FALSE)
#### 2019 & 2020 data together ####
#import 2019
FRCH_Q_2019 <- read_csv("~/Documents/DoD_2019/Storm Analysis/Plots/Hydrograph Separation /FRCH/FRCH_Q_2019.csv")
#import 2020
FRCH_Q_2020 <- read_csv("Predicted_Discharge/Processed/FRCH_Q_2020.csv")
colnames(FRCH_Q_2019)
colnames(FRCH_Q_2020)
#Combine data sets
FRCH_all <- full_join(FRCH_Q_2019, FRCH_Q_2020)
view(FRCH_all)
FRCH_final_2019 <- read_csv("~/Documents/DoD_2019/Q/Final_Q/FRCH/FRCH.csv")
colnames(FRCH_final_2019)
FRCH_final_2019 <- FRCH_final_2019[,-c(4:5)]
head(FRCH_final_2019)
str(FRCH_final_2019)
View(FRCH_Q_2019)
View(FRCH_final_2019)
FRCH_final_2020 <- read_csv("Predicted_Discharge/Processed/FRCH.csv")
names(FRCH_final_2020) <- c("Site", "DateTime", "MeanDischarge")
colnames(FRCH_final_2019)
colnames(FRCH_final_2020)
FRCH_ALL.final.discharge <- full_join(FRCH_final_2019, FRCH_final_2020)
View(FRCH_ALL.final.discharge)
FRCH_Q_bf_2019_2020 = BaseflowSeparation(FRCH_ALL.final.discharge$MeanDischarge, filter_parameter = 0.90, passes = 3)
nrow(FRCH_ALL.final.discharge)
any(is.na(FRCH_ALL.final.discharge))
any(is.na(FRCH_all))
FRCH_ALL.final.discharge <- na.omit(FRCH_ALL.final.discharge)
nrow(FRCH_ALL.final.discharge)
any(is.na(FRCH_all))
nrow(FRCH_all)
FRCH_all <- na.omit(FRCH_all)
nrow(FRCH_all)
FRCH_Q_bf_2019_2020 = BaseflowSeparation(FRCH_ALL.final.discharge$MeanDischarge, filter_parameter = 0.90, passes = 3)
hydrograph(input=subset(FRCH_all, select = c(day, Discharge_Lsec)), streamflow2=FRCH_Q_bf$bt)
hydrograph(input=subset(FRCH_all, select = c(day, Discharge_Lsec)), streamflow2=FRCH_Q_bf$bt)
FRCH_Q_bf_2019_2020 = BaseflowSeparation(FRCH_ALL.final.discharge$MeanDischarge, filter_parameter = 0.90, passes = 3)
head(FRCH_Q_bf_2019_2020)
FRCH_Q_bf_2019_2020 = BaseflowSeparation(FRCH_ALL.final.discharge$MeanDischarge, filter_parameter = 0.90, passes = 3)
hydrograph(input=subset(FRCH_all, select = c(day, Discharge_Lsec)), streamflow2=FRCH_Q_bf_2019_2020$bt)
###.925 ###
FRCH_Q_bf = BaseflowSeparation(frch.final.discharge$MeanDischarge, filter_parameter = 0.925, passes = 3)
hydrograph(input=subset(FRCH_Q, select = c(day, Discharge_Lsec)), streamflow2=FRCH_Q_bf$bt)
?hydrograph
head(FRCH_all)
head(FRCH_Q)
data(OwascoInlet)
#
STRT_Q_bf = BaseflowSeparation(strt.final.discharge$MeanDischarge, filter_parameter = 0.925, passes = 3)
head(OwascoInlet)
hydrograph(OwascoInlet)
View(OwascoInlet)
not.going.to.work <- left_join(FRCH_all, FRCH_ALL.final.discharge, by = "DateTime")
head(FRCH_all)
not.going.to.work <- full_join(FRCH_all, FRCH_ALL.final.discharge)
hydrograph(FRCH_ALL.final.discharge)
hydrograph(FRCH_all)
str(FRCH_all)
hydrograph(FRCH_all)
View(FRCH_all)
head(FRCH_Q)
head(FRCH_Q_bf_2019_2020)
any(is.na(FRCH_Q_bf_2019_2020))
hydrograph(FRCH_Q_bf_2019_2020)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(scales)
library(plyr)
library(imputeTS)
library(TSA)
library(bbmle)
library(zoo)
library(xts)
library(forecast)
library(stats)
library(lattice)
library(nlme)
library(geosphere)
library(car)
library(EcoHydRology)
#
FRCH_Q_bf = BaseflowSeparation(frch.final.discharge$MeanDischarge, filter_parameter = 0.90, passes = 3)
